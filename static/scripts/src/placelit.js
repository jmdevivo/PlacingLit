// Generated by CoffeeScript 1.10.0
(function() {
  var PLMap;

  PLMap = (function() {
    function PLMap() {
      this.elements = {
        modals: {
          mapmodal: $('#mapmodal'),
          querymodal: $('#querymodal')
        }
      };
      this.path = window.location.pathname;
      this.search = this.parseQuery(window.location.search);
      this.scenes = window.SCENES;
    }

    PLMap.prototype.showModal = function(element) {
      return element.modal();
    };

    PLMap.prototype.isFiltered = function() {
      if ((this.path.indexOf('collections') === -1) && (this.path.indexOf('author') === -1) && (this.path.indexOf('title') === -1) && (this.path.indexOf('coords') === -1) && (this.path.indexOf('filter') === -1)) {
        return false;
      }
      return true;
    };

    PLMap.prototype.hasScenes = function() {
      return this.scenes && this.scenes.length > 0;
    };

    PLMap.prototype.selectMapView = function() {
      if (this.isFiltered() && this.hasScenes()) {
        console.log("this is a search =================");
        return new PlacingLit.Views.MapFilterView(this.scenes);
      }
      console.log("this is a default view ===============");
      return new PlacingLit.Views.MapCanvasView;
    };

    PLMap.prototype.isShareLink = function() {
      var pathname;
      pathname = window.location.pathname;
      if (pathname.indexOf("map") > -1 && pathname.indexOf("filter") > -1 && pathname.indexOf("id") > -1) {
        console.log("is share link");
        return true;
      }
    };

    PLMap.prototype.closeFeatContent = function() {
      return $('#mapOverlay').hide();
    };

    PLMap.prototype.displayEmptyResultsError = function() {
      var alertMessage, author, author_path;
      author_path = '/map/filter/author/';
      author = decodeURIComponent(this.path.replace(author_path, ''));
      alertMessage = 'Whoa! No places found for ' + author + '. ';
      alertMessage += 'But that\'s ok!. Be the first to map this author. ';
      alertMessage += 'Click the map to add a book and author.';
      return alert(alertMessage);
    };

    PLMap.prototype.parseQuery = function(q) {
      var i, len, param, result, splitq, vals;
      result = {};
      splitq = q.split('&');
      for (i = 0, len = splitq.length; i < len; i++) {
        param = splitq[i];
        vals = param.split('=');
        result[vals[0]] = vals[1];
      }
      return result;
    };

    PLMap.prototype.parseURI = function(URI) {
      var split;
      split = URI.split('/');
      return split;
    };

    return PLMap;

  })();

  $(function() {
    var plmap, view;
    plmap = new PLMap();
    view = plmap.selectMapView();
    if (location.search === '?modal=1') {
      plmap.showModal(plmap.elements.modals.mapmodal);
    } else if (plmap.isFiltered()) {
      if (plmap.scenes && plmap.scenes.length > 0) {
        plmap.closeFeatContent();
        plmap.showModal(plmap.elements.modals.querymodal);
      } else {
        plmap.displayEmptyResultsError();
        if (history) {
          console.log("history should be cleared");
          history.replaceState(null, null, '/');
        }
      }
    }
    if (!Modernizr.input.placeholder) {
      view.handleInputAttributes();
    }
    return view.showInfowindowFormAtLocation();
  });

}).call(this);
